<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geometry Rush: Hardcore</title>
    <style>
        body {
            margin: 0; padding: 0;
            background-color: #050505;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh;
            font-family: 'Courier New', sans-serif;
            overflow: hidden; touch-action: manipulation;
        }
        
        canvas {
            background: linear-gradient(to bottom, #1a1a1a, #000);
            border-top: 3px solid #ff0055;
            border-bottom: 3px solid #ff0055;
            box-shadow: 0 0 25px rgba(255, 0, 85, 0.3);
            max-width: 100%;
        }

        .ui-layer { position: absolute; top: 8%; text-align: center; color: white; pointer-events: none; width: 100%; }
        h1 { margin: 0; font-size: 32px; text-shadow: 0 0 10px #ff0055; letter-spacing: 2px; font-style: italic; }
        .credit { color: #00ffcc; font-size: 12px; margin-top: 5px; font-weight: bold; text-shadow: 0 0 5px #00ffcc; }
        
        #score-display { font-size: 28px; color: #fff; margin-top: 15px; font-weight: 800; }
        
        #game-over-screen {
            display: none; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px; border-radius: 20px; text-align: center;
            border: 3px solid #ff0055; z-index: 10;
            box-shadow: 0 0 50px rgba(255, 0, 85, 0.5);
            width: 80%; max-width: 300px;
        }
        
        button {
            background: #ff0055; color: white; border: none;
            padding: 15px 30px; font-size: 18px; font-weight: bold;
            border-radius: 5px; cursor: pointer; margin-top: 20px;
            box-shadow: 0 0 15px #ff0055; text-transform: uppercase;
        }
        button:active { transform: scale(0.95); }

        footer { position: absolute; bottom: 10px; opacity: 0.7; }
    </style>
</head>
<body>

    <div class="ui-layer">
        <h1>GEOMETRY RUSH</h1>
        <div class="credit">MADE BY ACS âš¡</div>
        <div id="score-display">0000</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="game-over-screen">
        <h2 style="color:#ff0055; margin:0; font-size:40px;">DEAD ðŸ’€</h2>
        <p style="color:white; margin:10px 0;">Score: <span id="final-score">0</span></p>
        <button onclick="resetGame()">RETRY</button>
    </div>

    <footer>
        <img src="https://visitor-badge.laobi.icu/badge?page_id=aegisacs007.geometry-rush&left_text=Players" alt="Visitors">
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Responsive Canvas
        canvas.width = window.innerWidth > 600 ? 600 : window.innerWidth;
        canvas.height = 320;
        const groundY = 280;

        // Game Variables
        let gameRunning = false; // Wait for first tap
        let score = 0;
        let speed = 6; // Started faster
        let frameCount = 0;
        let speedMultiplier = 0.002; // Gets harder every frame

        // Player
        const player = {
            x: 50, y: 200, width: 30, height: 30,
            dy: 0, jumpPower: -13, gravity: 0.9,
            grounded: false, color: '#00ffcc', rotation: 0
        };

        let obstacles = [];

        // --- AUDIO ENGINE (Tense Drone + SFX) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let droneOsc;

        function startDrone() {
            if (droneOsc) return;
            droneOsc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            droneOsc.type = 'sawtooth';
            droneOsc.frequency.value = 50; // Low hum
            gain.gain.value = 0.02; // Quiet background
            droneOsc.connect(gain); gain.connect(audioCtx.destination);
            droneOsc.start();
        }

        function updateDrone() {
            if(droneOsc && gameRunning) {
                // Drone gets higher pitch as you go faster
                droneOsc.frequency.exponentialRampToValueAtTime(50 + (score/5), audioCtx.currentTime + 0.1);
            }
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);

            if (type === 'jump') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'crash') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.5, audioCtx.currentTime); // LOUD
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        // --- CONTROLS ---
        function handleInput(e) {
            if(e.type === 'touchstart') e.preventDefault(); 
            if(!gameRunning && document.getElementById('game-over-screen').style.display === 'none') {
                gameRunning = true; // Start on first tap
                startDrone();
                update();
            }
            if (player.grounded && gameRunning) {
                player.dy = player.jumpPower;
                player.grounded = false;
                playSound('jump');
            }
        }
        document.addEventListener('touchstart', handleInput, {passive: false});
        document.addEventListener('mousedown', handleInput);
        document.addEventListener('keydown', (e) => { if(e.code === 'Space') handleInput(e); });

        // --- GAME LOOP ---
        function update() {
            if (!gameRunning) return;

            // Clear
            ctx.fillStyle = '#050505';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Ground
            ctx.fillStyle = '#222';
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
            ctx.strokeStyle = '#fff';
            ctx.beginPath(); ctx.moveTo(0, groundY); ctx.lineTo(canvas.width, groundY); ctx.stroke();

            // 1. PLAYER PHYSICS
            player.dy += player.gravity;
            player.y += player.dy;

            // Rotate Cube while jumping
            if(!player.grounded) player.rotation += 0.15;
            else { 
                // Snap to flat when grounded
                player.rotation = Math.round(player.rotation / (Math.PI/2)) * (Math.PI/2); 
            }

            if (player.y + player.height > groundY) {
                player.y = groundY - player.height;
                player.dy = 0;
                player.grounded = true;
                player.rotation = 0;
            }

            // Draw Player (with Rotation)
            ctx.save();
            ctx.translate(player.x + player.width/2, player.y + player.height/2);
            ctx.rotate(player.rotation);
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 20; ctx.shadowColor = player.color;
            ctx.fillRect(-player.width/2, -player.height/2, player.width, player.height);
            ctx.restore();

            // 2. OBSTACLE SPAWNING (The Hard Part)
            frameCount++;
            speed += speedMultiplier; // Accerelate
            updateDrone();

            let spawnRate = Math.floor(100 - (speed * 2)); // Spawn faster as speed increases
            if(spawnRate < 40) spawnRate = 40; // Cap max spawn rate

            if (frameCount % spawnRate === 0 || Math.random() < 0.01) {
                if(frameCount > 60) {
                    let type = Math.random();
                    // 30% Chance of DOUBLE SPIKE
                    if(type < 0.3) {
                         obstacles.push({x: canvas.width, y: groundY - 30, w: 50, h: 30, type: 'spike'}); 
                    } else {
                         obstacles.push({x: canvas.width, y: groundY - 30, w: 20, h: 30, type: 'spike'}); 
                    }
                    frameCount = 0;
                }
            }

            // 3. MOVE OBSTACLES
            for (let i = 0; i < obstacles.length; i++) {
                let obs = obstacles[i];
                obs.x -= speed;

                ctx.fillStyle = '#ff0055';
                ctx.shadowBlur = 10; ctx.shadowColor = '#ff0055';
                
                // Draw Spikes
                ctx.beginPath();
                ctx.moveTo(obs.x, obs.y + obs.h);
                ctx.lineTo(obs.x + obs.w/2, obs.y);
                ctx.lineTo(obs.x + obs.w, obs.y + obs.h);
                ctx.fill();
                ctx.shadowBlur = 0;

                // COLLISION (Precise Hitbox)
                if (
                    player.x < obs.x + obs.w - 5 &&
                    player.x + player.width > obs.x + 5 &&
                    player.y < obs.y + obs.h &&
                    player.y + player.height > obs.y + 10
                ) {
                    gameOver();
                }

                if (obs.x + obs.w < 0) {
                    obstacles.splice(i, 1);
                    score += 10;
                    i--;
                }
            }

            document.getElementById('score-display').innerText = score;
            requestAnimationFrame(update);
        }

        function gameOver() {
            gameRunning = false;
            if(droneOsc) { droneOsc.stop(); droneOsc = null; } // Stop hum
            playSound('crash');
            document.getElementById('game-over-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
        }

        function resetGame() {
            obstacles = []; score = 0; speed = 6; frameCount = 0;
            player.y = 200; player.dy = 0; player.rotation = 0;
            gameRunning = true;
            document.getElementById('game-over-screen').style.display = 'none';
            startDrone();
            update();
        }

        // Draw initial frame
        ctx.fillStyle = '#050505'; ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = '#fff'; ctx.fillText("TAP TO START", canvas.width/2 - 40, canvas.height/2);

    </script>
</body>
</html>
